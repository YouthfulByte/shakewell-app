<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shakewell ËØ¶ÊÉÖ</title>
    <style>
        body {
            background-color: #FFF9C4;
            font-family: -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .detail-container {
            width: 393px;
            max-width: 100%;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: relative;
        }
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #6A1B9A;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(106,27,154,0.3);
        }
        .back-btn:hover {
            background: #5a1880;
        }
        .drink-name {
            font-size: 28px;
            color: #6A1B9A;
            text-align: center;
            margin: 20px 0 10px;
        }
        .drink-img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 16px;
            color: #666;
        }
        .unit-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .unit-btn {
            background: #F5F5F5;
            border: 1px solid #DDD;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 14px;
        }
        .unit-btn.active {
            background: #6A1B9A;
            color: white;
        }
        .ingredients {
            margin: 20px 0;
        }
        .ingredient {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #EEE;
            font-size: 14px;
        }
        .instructions {
            background: #F5F5F5;
            padding: 15px;
            border-radius: 8px;
            line-height: 1.5;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }
        .instructions::-webkit-scrollbar {
            width: 6px;
        }
        .instructions::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        .instructions::-webkit-scrollbar-thumb {
            background: #6A1B9A;
            border-radius: 3px;
        }
        .instructions::-webkit-scrollbar-thumb:hover {
            background: #5a1880;
        }
        .step {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }
        .step::before {
            content: '‚óè';
            position: absolute;
            left: 0;
            color: #6A1B9A;
            font-size: 18px;
        }
        .shake-btn {
            width: 100%;
            background: #6A1B9A;
            color: white;
            border: none;
            padding: 15px;
            font-size: 18px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 20px;
            animation: shake 0.5s infinite;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.close() || history.back()">‚Üê</button>
    <div class="detail-container">
        <div id="loading" style="text-align: center; padding: 40px; color: #6A1B9A;">Âä†ËΩΩËØ¶ÊÉÖ...</div>
        <div id="content" style="display: none;">
            <div class="drink-name" id="name"></div>
            <img id="img" class="drink-img" alt="Drink">
            <div class="info-row">
                <span>Âü∫ÈÖí: <span id="base-spirit"></span></span>
                <span></span>
            </div>
            <div class="unit-toggle">
                <button class="unit-btn active" onclick="switchUnit(event, 'ml')">ml</button>
                <button class="unit-btn" onclick="switchUnit(event, 'oz')">oz</button>
            </div>
            <div class="ingredients">
                <h3 style="color: #6A1B9A; margin-bottom: 10px;">ÊùêÊñô</h3>
                <div id="ings"></div>
            </div>
            <div class="instructions">
                <h3 style="color: #6A1B9A; margin-bottom: 10px;">Ê≠•È™§</h3>
                <div id="instructions"></div>
            </div>
            <button class="shake-btn" onclick="shakeSurprise()">Êëá‰∏ÄÊëáÊÉäÂñúÔºÅüç∏</button>
        </div>
    </div>
  
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');
        const apiKey = '1';
        let currentUnit = 'ml'; // ÈªòËÆ§ ml
        let drink; // ÂÖ®Â±Ä drink ÂØπË±°
        function getBaseSpirit(ingredient1) {
            const lower = ingredient1?.toLowerCase() || '';
            if (lower.includes('gin')) return 'Gin';
            if (lower.includes('vodka')) return 'Vodka';
            if (lower.includes('rum')) return 'Rum';
            if (lower.includes('tequila')) return 'Tequila';
            if (lower.includes('whiskey') || lower.includes('whisky') || lower.includes('scotch') || lower.includes('bourbon')) return 'Whiskey';
            return ingredient1 || 'N/A';
        }
        function switchUnit(event, unit) {
            currentUnit = unit;
            document.querySelectorAll('.unit-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderIngredients(); // ÈáçÊñ∞Ê∏≤Êüì
        }
        function parseMeasure(measure) {
            if (!measure) return {value: 0, unit: ''};
            const fractionMatch = measure.match(/(\d+)\/(\d+)/);
            let num = 0;
            if (fractionMatch) {
                num = parseInt(fractionMatch[1]) / parseInt(fractionMatch[2]);
            } else {
                const numMatch = measure.match(/(\d*\.?\d+)/);
                if (numMatch) num = parseFloat(numMatch[1]);
            }
            const unitMatch = measure.match(/(oz|ml|cl|dash|spoon)/i);
            const unit = unitMatch ? unitMatch[0].toLowerCase() : '';
            return {value: num, unit};
        }
        function convertMeasure(measure, targetUnit) {
            const parsed = parseMeasure(measure);
            if (parsed.value === 0) return measure;
            let mlValue = parsed.value;
            switch (parsed.unit) {
                case 'oz': mlValue *= 29.5735; break;
                case 'cl': mlValue *= 10; break;
                case 'ml': break; // already ml
                default: return measure; // unknown, keep original
            }
            if (targetUnit === 'ml') {
                return `${mlValue.toFixed(2)} ml`;
            } else if (targetUnit === 'oz') {
                return `${(mlValue / 29.5735).toFixed(2)} oz`;
            }
            return measure;
        }
        function renderIngredients() {
            let ingsHtml = '';
            for (let i = 1; i <= 15; i++) {
                const ing = drink['strIngredient' + i];
                let measure = drink['strMeasure' + i];
                if (ing) {
                    if (measure) {
                        measure = convertMeasure(measure, currentUnit);
                    }
                    ingsHtml += `<div class="ingredient"><span>${measure || ''} ${ing}</span></div>`;
                }
            }
            document.getElementById('ings').innerHTML = ingsHtml;
        }
        async function loadDetail() {
            if (!id) return;
            const response = await fetch(`https://www.thecocktaildb.com/api/json/v1/${apiKey}/lookup.php?i=${id}`);
            const data = await response.json();
            drink = data.drinks[0];
            if (!drink) return;
            document.getElementById('name').textContent = drink.strDrink;
            document.getElementById('img').src = drink.strDrinkThumb + '/large';
            document.getElementById('base-spirit').textContent = getBaseSpirit(drink.strIngredient1);
            renderIngredients(); // ÂàùÂßãÊ∏≤Êüì
            const steps = (drink.strInstructions || '').split('.').filter(s => s.trim()).map((step, idx) => `<div class="step">${step.trim()}</div>`).join('');
            document.getElementById('instructions').innerHTML = steps;
            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';
            let history = JSON.parse(localStorage.getItem('shakewellHistory') || '[]');
            history = [drink, ...history.filter(h => h.idDrink !== id)].slice(0, 20);
            localStorage.setItem('shakewellHistory', JSON.stringify(history));
        }
        function shakeSurprise() {
            let all = JSON.parse(localStorage.getItem('allCocktails') || '[]');
            if (all.length === 0) all = [{idDrink: 'random'}];
            const randomId = all[Math.floor(Math.random() * all.length)].idDrink;
            window.open(`detail.html?id=${randomId}`, '_self');
        }
        window.onload = loadDetail;
    </script>
</body>
</html>